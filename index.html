<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Physical Distance Monitor</title>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  </head>

  <body>

    <script type="module">

      import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.112.1/build/three.module.js';

      import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.112.1/examples/jsm/controls/OrbitControls.js';

      import {DDSLoader} from 'https://cdn.jsdelivr.net/npm/three@0.112.1/examples/jsm/loaders/DDSLoader.js';
      import {OBJLoader} from 'https://cdn.jsdelivr.net/npm/three@0.112.1/examples/jsm/loaders/OBJLoader.js';
      import {MTLLoader} from 'https://cdn.jsdelivr.net/npm/three@0.112.1/examples/jsm/loaders/MTLLoader.js';
      import {FBXLoader} from 'https://cdn.jsdelivr.net/npm/three@0.118.1/examples/jsm/loaders/FBXLoader.js';

      let camera, scene, renderer;

      const clock = new THREE.Clock();
      
      let mixer;

      init();
      animate();


      function init() {

        const container = document.createElement( 'div' );
        document.body.appendChild( container );

        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
        camera.position.x = 5;
        camera.position.z = 15;
        camera.position.y = 10;

        // scene

        scene = new THREE.Scene();

        const ambientLight = new THREE.AmbientLight( 0xcccccc, 0.4 );
        scene.add( ambientLight );

        const pointLight = new THREE.PointLight( 0xffffff, 0.8 );
        camera.add( pointLight );
        scene.add( camera );

        // model

        const onProgress = function ( xhr ) {

          if ( xhr.lengthComputable ) {

            const percentComplete = xhr.loaded / xhr.total * 100;
            console.log( Math.round( percentComplete, 2 ) + '% downloaded' );

          }

        };

        const onError = function () { };

        const manager = new THREE.LoadingManager();
        manager.addHandler( /\.dds$/i, new DDSLoader() );

        // comment in the following line and import TGALoader if your asset uses TGA textures
        // manager.addHandler( /\.tga$/i, new TGALoader() );

        new MTLLoader( manager )
          .setPath( '/models/obj/office/' )
          .load( 'office.mtl', function ( materials ) {

            materials.preload();

            new OBJLoader( manager )
              .setMaterials( materials )
              .setPath( '/models/obj/office/' )
              .load( 'office.obj', function ( object ) {

                object.position.y = 0;
                object.position.z = 0;
                scene.add( object );

              }, onProgress, onError );

          } );

        new FBXLoader().load( 'models/fbx/rp_nathan_animated_003_walking.fbx', function ( object ) {

					mixer = new THREE.AnimationMixer( object );

					const action = mixer.clipAction( object.animations[ 0 ] );
					action.play();

					object.traverse( function ( child ) {

						if ( child.isMesh ) {
							child.castShadow = true;
							child.receiveShadow = true;
						}

          } );
          object.scale.set(0.008, 0.008, 0.008);
          object.position.x = -0.5;
          object.position.y = 0.2;
					scene.add( object );

				} );

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        const controls = new OrbitControls( camera, renderer.domElement );
				controls.target.set( 0, 0, 0 );
				controls.update();

        window.addEventListener( 'resize', onWindowResize, false );

      }

      function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

      }

      //

      function animate() {

				requestAnimationFrame( animate );

				const delta = clock.getDelta();

				if ( mixer ) mixer.update( delta );

        renderer.render( scene, camera );
        
      }

      function render() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

      }

    </script>

  </body>
</html>